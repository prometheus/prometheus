# Use Go 1.23 for testing
FROM golang:1.23

# Install necessary build tools
RUN apt-get update && apt-get install -y git make

# Set working directory
WORKDIR /prometheus

# Copy go mod files
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy source code
COPY . .

# Run tests with the same flags as CI
CMD ["sh", "-c", "go test --tags=dedupelabels ./cmd/promtool/... -v"]