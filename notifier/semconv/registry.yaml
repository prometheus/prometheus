# Semantic convention registry for Prometheus notifier metrics.
#
# This file is the source of truth for these metrics.
# Run `make generate-semconv` to regenerate the Go code.

groups:
  # Attribute definition for alertmanager label
  - id: attr.alertmanager
    type: attribute_group
    brief: Attributes for alertmanager metrics.
    attributes:
      - id: alertmanager
        type: string
        stability: development
        brief: The alertmanager instance URL.
        examples:
          - "http://alertmanager:9093/api/v2/alerts"

  # Simple metrics (no labels)
  - id: metric.prometheus_notifications_alertmanagers_discovered
    type: metric
    stability: development
    brief: The number of alertmanagers discovered and active.
    metric_name: prometheus_notifications_alertmanagers_discovered
    instrument: gauge
    unit: "{alertmanager}"
    # Note: This is implemented as GaugeFunc in code (requires callback)

  - id: metric.prometheus_notifications_dropped_total
    type: metric
    stability: development
    brief: Total number of alerts dropped due to errors when sending to Alertmanager.
    metric_name: prometheus_notifications_dropped_total
    instrument: counter
    unit: "{notification}"

  - id: metric.prometheus_notifications_queue_capacity
    type: metric
    stability: development
    brief: The capacity of the alert notifications queue.
    metric_name: prometheus_notifications_queue_capacity
    instrument: gauge
    unit: "{notification}"

  - id: metric.prometheus_notifications_queue_length
    type: metric
    stability: development
    brief: The number of alert notifications in the queue.
    metric_name: prometheus_notifications_queue_length
    instrument: gauge
    unit: "{notification}"
    # Note: This is implemented as GaugeFunc in code (requires callback)

  # Metrics with alertmanager label
  - id: metric.prometheus_notifications_errors_total
    type: metric
    stability: development
    brief: Total number of sent alerts affected by errors.
    metric_name: prometheus_notifications_errors_total
    instrument: counter
    unit: "{notification}"
    attributes:
      - ref: alertmanager

  - id: metric.prometheus_notifications_sent_total
    type: metric
    stability: development
    brief: Total number of alerts sent.
    metric_name: prometheus_notifications_sent_total
    instrument: counter
    unit: "{notification}"
    attributes:
      - ref: alertmanager

  - id: metric.prometheus_notifications_latency_seconds
    type: metric
    stability: development
    brief: Latency quantiles for sending alert notifications.
    metric_name: prometheus_notifications_latency_seconds
    instrument: histogram
    unit: s
    attributes:
      - ref: alertmanager
    annotations:
      prometheus:
        histogram_type: summary
        objectives:
          0.5: 0.05
          0.9: 0.01
          0.99: 0.001

  - id: metric.prometheus_notifications_latency_histogram_seconds
    type: metric
    stability: development
    brief: Latency histogram for sending alert notifications.
    metric_name: prometheus_notifications_latency_histogram_seconds
    instrument: histogram
    unit: s
    attributes:
      - ref: alertmanager
    annotations:
      prometheus:
        histogram_type: mixed_histogram
        buckets: [0.01, 0.1, 1, 10]
        bucket_factor: 1.1
        max_bucket_number: 100
        min_reset_duration: "1h"
