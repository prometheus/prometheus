#include <gtest/gtest.h>

#include "bare_bones/crc32.h"

namespace {

struct CRC32 : public testing::Test {};

TEST_F(CRC32, table_test_u32) {
  uint32_t data[10][16] = {
      {3300311985ull, 2811223738ull, 2223131809ull, 3140774898ull, 1496532081ull, 427170376ull, 3259206669ull, 3680559237ull, 3546041770ull, 1990932045ull,
       2690789362ull, 2913452014ull, 2957319417ull, 2349334832ull, 1158290409ull, 1589432850ull},
      {3101860670ull, 911180223ull, 832313842ull, 510190837ull, 2989614271ull, 1133520675ull, 3141483819ull, 1969637270ull, 2906477651ull, 622719782ull,
       2872518761ull, 1668827546ull, 1563757449ull, 3228944377ull, 2512722203ull, 1461953941ull},
      {2256555673ull, 3301210546ull, 713536302ull, 4036189071ull, 1689437389ull, 3512325809ull, 652772144ull, 1846948056ull, 3607000943ull, 1535975194ull,
       1380864786ull, 3809719389ull, 2916539973ull, 3146136943ull, 3876372651ull, 2633395656ull},
      {3796994914ull, 1866593207ull, 3600889038ull, 1157686882ull, 2603381170ull, 2547134025ull, 2630467233ull, 4250224987ull, 2624824048ull, 3513939761ull,
       170354394ull, 3884682661ull, 1993100300ull, 2751510410ull, 1235698298ull, 2146571619ull},
      {569321895ull, 304304601ull, 4228520929ull, 2916732252ull, 1223841829ull, 4085016093ull, 736686663ull, 2795780115ull, 2372103693ull, 3911876349ull,
       3777502468ull, 676712856ull, 4097936062ull, 4287096030ull, 1633742138ull, 993654096ull},
      {3601449534ull, 1703207260ull, 1882857752ull, 2463333561ull, 3366843323ull, 1630500541ull, 811752075ull, 1768461732ull, 3391876480ull, 1742835393ull,
       3291896607ull, 955707057ull, 2920325116ull, 2341426274ull, 3965080507ull, 346664604ull},
      {472361079ull, 2872453806ull, 4223455499ull, 3004564277ull, 764789541ull, 72441726ull, 899067207ull, 3246664767ull, 3053526856ull, 1395301137ull,
       3732876673ull, 4152469055ull, 3256961313ull, 2895786171ull, 1423855005ull, 3423207279ull},
      {2392667702ull, 808647247ull, 930408552ull, 3074913265ull, 665018273ull, 3873291740ull, 1611834171ull, 868063898ull, 487394206ull, 370713571ull,
       1890409271ull, 291198257ull, 4176944650ull, 627412135ull, 2197024896ull, 1839157164ull},
      {2046975878ull, 2385317048ull, 4155347229ull, 3014426775ull, 3698506830ull, 1729644613ull, 316984004ull, 2388350316ull, 2123576994ull, 891291733ull,
       2387093880ull, 2165956551ull, 880212535ull, 2486706290ull, 3263461312ull, 2641480002ull},
      {1809331184ull, 3627312524ull, 2988335579ull, 2188033491ull, 3081507649ull, 2571028965ull, 36659484ull, 3871316046ull, 2807416355ull, 3458898055ull,
       2948847088ull, 1363951374ull, 1203909037ull, 137559917ull, 2675989516ull, 3760865724ull},
  };
  uint32_t sums[10] = {3439403789ul, 2091982086ul, 3492542733ul, 3933481888ul, 3748444148ul,
                       1827453498ul, 1131826987ul, 1746766066ul, 436558575ul,  3815745529ul};
  for (int i = 0; i < 10; ++i) {
    BareBones::CRC32 sum;
    for (uint32_t x : data[i]) {
      sum << x;
    }
    ASSERT_EQ(sums[i], uint32_t(sum));
  }
}

TEST_F(CRC32, table_test_u64) {
  uint64_t data[10][8] = {
      {12074114019749184433ull, 13489525473230867617ull, 1834682796236555377ull, 15807881557164919821ull, 8550988025379442090ull, 12513181121286123506ull,
       10090316273750973689ull, 6826562111096364009ull},
      {3913489261648847678ull, 2191252960466180594ull, 4868434231454459071ull, 8459527662774205739ull, 2674561101168727123ull, 7167559735606454377ull,
       13868210501381852041ull, 6279044367366035739ull},
      {14178591334536859289ull, 17335300061131158318ull, 15085324484241179853ull, 7932581498583548720ull, 6596963229304256367ull, 16362620184072966930ull,
       13512555281838956101ull, 11310348223824838827ull},
      {8016956782797753186ull, 4972227300799100110ull, 10939857338507227570ull, 18254577322437492385ull, 15092256356233880304ull, 16684584984503609050ull,
       11817647227546651660ull, 9219454903362470522ull},
      {1306978309886650791ull, 12527269637756951521ull, 17545010524292536357ull, 12007784161468805703ull, 16801380987322985997ull, 2906459589080259844ull,
       18412937247759370942ull, 4267711847490186554ull},
      {7315219483611218494ull, 10579937085517078808ull, 7002946503072150459ull, 7595485303979268747ull, 7485421018638183808ull, 4104730557663304479ull,
       10056349275745460220ull, 1488913140825871291ull},
      {12337095156513089655ull, 12904505312668340491ull, 311134844800582437ull, 13944318996239527239ull, 5992772754540142408ull, 17834718792609901953ull,
       12437306903911024929ull, 14702563312158002589ull},
      {3473113482258101814ull, 13206651912141989992ull, 16635661351831953313ull, 3728306054360113979ull, 1592202664115768222ull, 1250686992357612343ull,
       2694714605115481610ull, 7899119873781133440ull},
      {10244858713798238086ull, 12946864418967097629ull, 7428767050236083278ull, 10257886498928249540ull, 3828068846553740962ull, 9302712553489049976ull,
       10680322191187704375ull, 11345070224891475904ull},
      {15579188664760546288ull, 9397532289386045915ull, 11042485324825236289ull, 16627175810086691100ull, 14855854029230425635ull, 5858126547613111792ull,
       590815345959383469ull, 16152795291903351820ull},
  };
  uint32_t sums[10] = {3439403789ul, 2091982086ul, 3492542733ul, 3933481888ul, 3748444148ul,
                       1827453498ul, 1131826987ul, 1746766066ul, 436558575ul,  3815745529ul};
  for (int i = 0; i < 10; ++i) {
    BareBones::CRC32 sum;
    for (uint64_t x : data[i]) {
      sum << x;
    }
    ASSERT_EQ(sums[i], uint32_t(sum));
  }
}

}  // namespace
