---
version: 2.1

orbs:
  prometheus: prometheus/prometheus@0.4.0
  go: circleci/go@0.2.0
  win: circleci/windows@2.3.0

executors:
  # Whenever the Go version is updated here, .promu.yml
  # should also be updated.
  golang:
    docker:
    - image: circleci/golang:1.13-node

  fuzzit:
    docker:
      - image: fuzzitdev/golang:1.12.7-buster

jobs:
  test_windows:
    executor: win/default
    working_directory: /go/src/github.com/prometheus/prometheus
    steps:
    - checkout
    - run:
        shell: bash
        command: |
          go test ./win/ -test.v
        environment:
          GOGC: "20"
          GOOPTS: "-p 2 -mod=vendor"

workflows:
  version: 2
  prometheus:
    jobs:
    - test_windows:
        filters:
          tags:
            only: /.*/
